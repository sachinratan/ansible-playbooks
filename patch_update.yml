---
  - hosts: Patch-Group 
    user: root
    tasks:
      
     - name: Getting the Partition information with DF command and storing in variable
       script: /etc/ansible/diskfile.sh

     - name: Exclude the packages from upgradation.
       lineinfile:
        path: /etc/yum.conf
        line: 'exclude=mysql* MySQL* Php* php* Java* java*'
        insertafter: 'distroverpkg='
        state: present
        backup: yes

     - name: Update the packages on server
       yum: name=* state=latest
       ignore_errors: True

     - name: Reboot the System after updating the patches
       command: shutdown -r +1 "Rebooting systems after patching"
       async: 0
       poll: 0

     - name: Pause the ansible playbook execution for 3 minute to get systems up and running
       pause:
        minutes: 3

     - name: Verify that the systems are up and running
       local_action:
        module: wait_for
         host={{ inventory_hostname }}
         port=22
         delay=15
         timeout=300

     - name: File System Status Check
       shell: for i in `mount | grep -E '^/' | awk '{print $1}'`; do echo "$i:";  tune2fs -l $i | grep "Filesystem state:" ; tune2fs -l $i | grep "Mount count" ; tune2fs -l $i | grep "Last checked" ;done
